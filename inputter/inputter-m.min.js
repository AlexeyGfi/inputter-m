class InputterSuffixOrNot extends HTMLElement{constructor(){super();const a=this.attachShadow({mode:"open"});this.fieldType="numeric";this.defaultValue="0";this.linkAdded=!1;this.container=document.createElement("div");this.container.classList.add("inputter-m");this.container.addEventListener("click",()=>{this.input.focus()});this.measureSpan=document.createElement("span");this.measureSpan.classList.add("hidden-measurer");a.appendChild(this.measureSpan);this.input=document.createElement("input");
this.input.type="text";this.input.addEventListener("focus",()=>{this.dispatchEvent(new Event("focus"))});this.container.appendChild(this.input);a.appendChild(this.container);this.addEventListener("focus",()=>{this.focus()})}postfix(){if("numeric"===this.fieldType){let b;if(""!==this.input.value){b=this.input.value.replace(/,/g,".");var a=b="-"===b[0]&&this.allowNegative?"-"+b.replace(/[^\d.]/g,""):b.replace(/[^\d.]/g,""),c=[...a.matchAll(/\./g)];if(1<c.length){c.shift();for(let e=c.length,d=e-1;0<=
d;d--)a=a.slice(0,c[d].index)+a.slice(c[d].index+1);b=a}1<b.length&&(b=b.replace(/^0{1,}(?!\.)/,""));"."===b[0]&&(b="0"+b);this.input.value===b||isNaN(b)||(this.input.value=b)}if(""!==this.stableValue){b=String(this.stableValue).replace(/,/g,".");a=b="-"===b[0]&&this.allowNegative?"-"+b.replace(/[^\d.]/g,""):b.replace(/[^\d.]/g,"");c=[...a.matchAll(/\./g)];if(1<c.length){c.shift();for(let e=c.length,d=e-1;0<=d;d--)a=a.slice(0,c[d].index)+a.slice(c[d].index+1);b=a}1<b.length&&(b=b.replace(/^0{1,}(?!\.)/,
""));"."===b[0]&&(b="0"+b);this.stableValue!==b&&(this.stableValue=b)}}}focus(){this.input.focus()}static get observedAttributes(){return["data-error-css","data-suffix"]}attributeChangedCallback(a,c,b){"data-error-css"===a&&(b?this.container.classList.add("error"):this.container.classList.remove("error"));"data-suffix"===a&&(this.numSuffix=b,this.setSuffix())}setSuffix(a=!1){this.numSuffix&&("undefined"!==typeof this.suffix||a)&&("undefined"===typeof this.suffix?(this.suffix=document.createElement("span"),
this.suffix.innerHTML="\u043c2"===this.numSuffix?"\u043c<sup>2</sup>":"\u0440"===this.numSuffix?"&#8381;":this.numSuffix,"approvable"===this.mode&&(this.suffix.addEventListener("mouseover",()=>{this.approveReady=!0}),this.suffix.addEventListener("mouseout",()=>{this.approveReady=!1})),this.container.appendChild(this.suffix),this.suffix.addEventListener("click",()=>{this.input.select();this.input.focus()})):this.suffix.innerHTML="\u043c2"===this.numSuffix?"\u043c<sup>2</sup>":this.numSuffix)}connectedCallback(){switch(this.getAttribute("data-field-type")){case "free":this.fieldType=
"free";this.defaultValue="";break;default:this.fieldType="numeric",this.defaultValue="0"}var a=this.getAttribute("data-empty-value");"undefined"!==typeof a&&null!==a&&(this.defaultValue=a);if(!this.linkAdded){(a=this.getAttribute("data-css-file-mtime"))||(a="cached");let c=this.getAttribute("data-css-file");c||="/inputter/inputter-m.css";if(c&&a){const b=document.createElement("link");b.rel="stylesheet";b.href=c+"?v="+a;b.addEventListener("load",()=>{this.updateWidth()});this.linkAdded=!0;this.shadowRoot.appendChild(b)}}this.mode=
this.getAttribute("data-mode");this.mode||(this.mode="online");if(a=this.getAttribute("data-min-width"))this.container.style.minWidth=`${a}px`,this.input.style.minWidth=`${a}px`;this.input.placeholder=this.getAttribute("placeholder")||this.defaultValue;(this.additionalClass=this.getAttribute("data-additional-class"))&&this.container.classList.add(this.additionalClass);this.allowNegative="true"===this.getAttribute("is-allow-negative");this.numSuffix=this.getAttribute("data-suffix");this.setSuffix(!0);
this.value=a=this.getAttribute("value");this.stableValue=this.input.value=a;this.updateWidth();"approvable"===this.mode?(this.inputFocused=!1,this.input.addEventListener("focus",()=>{"0"===this.input.value&&"numeric"===this.fieldType&&(this.input.value="");this.inputFocused=!0}),this.input.addEventListener("input",()=>{this.postfix();this.updateWidth();this.lastValue=this.input.value;this.dispatchEvent(new Event("inputMove"))}),this.approveOrReject=()=>{this.approveReady?(this.stableValue=this.value=
this.lastValue,this.approveReady=!1,this.dispatchEvent(new Event("change"))):(this.lastValue=this.value=this.input.value=this.stableValue,this.dispatchEvent(new Event("reject")));this.dispatchEvent(new Event("inputMove"));this.dispatchEvent(new Event("input"))},this.input.addEventListener("keydown",c=>{if("Enter"===c.key||"Tab"===c.key)this.approveReady=!0,this.approveOrReject(),this.blur();"Escape"===c.key&&(this.approveReady=!1,this.approveOrReject(),this.blur())}),"undefined"===typeof this.approver&&
(this.approver=document.createElement("div"),this.approver.classList.add("approve"),this.approver.innerText="",this.addEventListener("inputMove",()=>{this.inputFocused&&this.lastValue!==this.stableValue?this.approver.classList.add("active"):this.approver.classList.remove("active")}),this.container.appendChild(this.approver),this.approveReady=!1,this.approver.addEventListener("mouseover",()=>{this.approveReady=!0}),this.approver.addEventListener("mouseout",()=>{this.approveReady=!1})),this.addEventListener("blur",
()=>{this.inputFocused=!1;this.approveOrReject()})):this.input.addEventListener("input",()=>{this.postfix();this.updateWidth()})}get value(){return"approvable"===this.mode?this.stableValue||this.defaultValue:this.input.value||this.defaultValue}set value(a){this.inputFocused||(a||(a=this.defaultValue),this.stableValue=`${a}`,this.input.value=`${a}`,this.postfix(),this.updateWidth())}updateWidth(){var a=this.input.value||"0";this.measureSpan.textContent=a;0>=this.measureSpan.offsetWidth?this.input.style.width=
`${a.length}ch`:(a=this.measureSpan.offsetWidth,this.input.style.width="mega_excel_inputter"===this.additionalClass?`${Math.max(20,Math.min(this.container.offsetWidth-(this.suffix?.offsetWidth||0)-10,a))}px`:`${a}px`)}}customElements.define("inputter-m",InputterSuffixOrNot);
